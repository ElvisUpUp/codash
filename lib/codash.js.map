{"version":3,"file":null,"sources":["../src/dispatch.js","../src/utils.js","../src/interceptor.js","../src/cordova.js","../src/deviceReady.js","../src/bindBackEvent.js"],"sourcesContent":["'use strict';\n\nconst createResponseData = (config, cordova) => (data, status = 0, timeout = false) => ({ config, cordova, data, status, timeout });\n\nexport default function dispatchCordovaEvent(config) {\n  const { hook, action, params, timeout } = config;\n  const TIME_OUT = timeout || 30 * 1000;\n\n  return new Promise((resolve, reject) => {\n    const sdk = cordova;\n    const responseFn = createResponseData(config, sdk);\n\n    if (typeof cordova !== 'undefined') {\n      let done = false;\n      cordova.exec((data) => {\n        if (!done) {\n          done = true;\n          resolve(responseFn(data));\n        }\n      }, (error) => {\n        done = true;\n        resolve(responseFn(error, -1));\n      }, hook, action, params || []);\n  \n      setTimeout(() => {\n        if (!done) {\n          done = true;\n          resolve(responseFn(null, -1, true));\n        }\n      }, TIME_OUT);\n    } else {\n      resolve(responseFn(null, -1));\n    }\n  });\n}\n","export const isArray = val => (Object.prototype.toString.call(val) === '[object Array]');\n\nexport const each = (obj, fn) => {\n  if (obj === null || typeof obj === 'undefined') {\n    return;\n  }\n\n  if (typeof obj !== 'object') {\n    obj = [obj];\n  }\n\n  if (isArray(obj)) {\n    for (let i = 0, l = obj.length; i < l; i += 1) {\n      fn.call(null, obj[i], i, obj);\n    }\n  } else {\n    for (let key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        fn.call(null, obj[key], key, obj);\n      }\n    }\n  }\n};\n\nexport const stringToJson = (string) => {\n  try {\n    return JSON.parse(string);\n  } catch (e) {\n    return string;\n  }\n};\n\n","'use strict';\n\nimport { each } from './utils';\n\nclass Interceptor {\n  constructor() {\n    this.handlers = [];\n  }\n\n  /**\n   * Add a new interceptor to the stack\n   *\n   * @param {Function} fulfilled The function to handle `then` for a `Promise`\n   * @param {Function} rejected The function to handle `reject` for a `Promise`\n   *\n   * @return {Number} An ID used to remove interceptor later\n   */\n  use(fulfilled, rejected) {\n    this.handlers.push({\n      fulfilled: fulfilled,\n      rejected: rejected\n    });\n    return this.handlers.length - 1;\n  }\n\n  /**\n   * Remove an interceptor from the stack\n   *\n   * @param {Number} id The ID that was returned by `use`\n   */\n  eject(id) {\n    if (this.handlers[id]) {\n      this.handlers[id] = null;\n    }\n  }\n\n  /**\n   * Iterate over all the registered interceptors\n   *\n   * This method is particularly useful for skipping over any\n   * interceptors that may have become `null` calling `eject`.\n   *\n   * @param {Function} fn The function to call for each interceptor\n   */\n  forEach(fn) {\n    each(this.handlers, (h) => {\n      if (h !== null) {\n        fn(h);\n      }\n    });\n  }\n}\n\nexport default Interceptor;\n","'use strict';\n\nimport dispatchCordovaEvent from './dispatch';\nimport Interceptor from './interceptor';\n\nclass Cordova {\n  constructor(instanceConfig) {\n    this.defaults = instanceConfig;\n    this.interceptors = {\n      before: new Interceptor(),\n      after: new Interceptor(),\n    };\n  }\n\n  handle(config) {\n    const chain = [dispatchCordovaEvent, undefined];\n    let promise = Promise.resolve(config);\n\n    this.interceptors.before.forEach((interceptor) => {\n      chain.unshift(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    this.interceptors.after.forEach((interceptor) => {\n      chain.push(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    while (chain.length) {\n      promise = promise.then(chain.shift(), chain.shift());\n    }\n\n    return promise;\n  }\n\n  create(config) {\n    return () => this.handle(config);\n  }\n}\n\nexport default Cordova;\n","'use strict';\n\nexport default function deviceReady() {\n  return new Promise((resolve) => {\n    document.addEventListener('deviceready', () => {\n      resolve();\n    }, false);\n  });\n}\n","'use strict';\n\nexport default function bindBackEvent(backEvent) {\n  const backButtonEvent = (channel) => {\n    if (channel.action === 'backbutton') {\n      backEvent && backEvent();\n    }\n  };\n  cordova.exec(null, null, \"CoreAndroid\", \"overrideBackbutton\", [true]);\n  cordova.exec(backButtonEvent, null, \"CoreAndroid\", \"messageChannel\", []);\n}\n"],"names":["createResponseData","config","cordova","data","status","timeout","dispatchCordovaEvent","hook","action","params","TIME_OUT","Promise","resolve","reject","sdk","responseFn","done","exec","error","isArray","Object","prototype","toString","call","val","each","obj","fn","i","l","length","key","hasOwnProperty","stringToJson","string","JSON","parse","e","Interceptor","handlers","fulfilled","rejected","push","id","h","Cordova","instanceConfig","defaults","interceptors","chain","undefined","promise","before","forEach","interceptor","unshift","after","then","shift","handle","deviceReady","addEventListener","bindBackEvent","backEvent","backButtonEvent","channel"],"mappings":"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"}